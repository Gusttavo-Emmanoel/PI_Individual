<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Troll | Perfil</title>

    <script src="js/sessao.js"></script>

    <link rel="stylesheet" href="style/estrutura.css">
    <link rel="stylesheet" href="style/perfil.css">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=EB+Garamond:ital,wght@0,400..800;1,400..800&display=swap"
        rel="stylesheet">
</head>

<body onload="validarSessao(), validarNav(), listarFichas()">
    <header>
        <div class="logo_texto">
            T<b>ROLL</b>
        </div>

        <nav>
            <a href="index.html" class="nav_item" id="inicio">
                <img src="img/inicio.svg" alt="icone de inicio">
                <span>Inicio</span>
            </a>
            <a href="como_jogar.html" class=" nav_item" id="como_jogar">
                <img src="img/como_jogar.svg" alt="icone de como_jogar">
                <span>Como Jogar</span>
            </a>
            <a href="./perfil.html" class="nav_select" id="perfil">
                <img src="img/perfil-selecionado.svg" alt="icone de perfil">
                <span>Perfil</span>
            </a>
            <a onclick="limparSessao()" class="nav_item" id="sair">
                <img src="img/sair.svg" alt="icone de sair">
                <span>Sair</span>
            </a>

            <a href="login.html" class="btn_secundario btn_secundario_selecionado" id="login">
                <span>Entrar</span>
            </a>
            <a href="cadastro.html" class="btn_primario" id="cadastrar">
                <span>Criar conta</span>
            </a>
        </nav>
    </header>
    <main>
        <section class="usuario">
            <div class="usuario_container">
                <h1>Usuário: <span id="b_usuario"></span></h1>
                <p><b id="qtFichas">0</b> personagens criados.</p>
            </div>
        </section>

        <section>
            <div class="ficha_head">
                <h2>Minhas Fichas</h2>
                <a href="ficha.html" class="btn_primario">
                    <span>+ Criar Nova Ficha</span>
                </a>
            </div>

            <div class="ficha_body" id="ficha_body">

                <!-- <div class="ficha_item">
                    <h3>Nome</h3>
                    <p>Classe: <b></b></p>
                    <p>Raça: <b></b></p>

                    <hr>

                    <a href="dashboard.html" class="btn_primario">
                        <span>Visualizar Ficha</span>
                    </a>
                </div> -->



            </div>

        </section>

    </main>
    <!--footer inicio-->
    <footer>
        <div class="footer_logo_texto">
            T<b>ROLL</b>
        </div>

        <nav>
            <div class="nav_item">
                <a href="index.html">Inicio</a>
            </div>
            |
            <div class="nav_item">
                <a href="como_jogar.html">Como Jogar</a>
            </div>
        </nav>
    </footer>
    <!--footer fim-->


</body>
<script>
    function listarFichas() {
        let idUsuario = Number(sessionStorage.ID_USUARIO)

        console.log('Chegoi aqui', idUsuario);

        fetch(`/fichas/${idUsuario}`, {
            method: "GET"
        }).then(function (resposta) {
            if (resposta.status == 200) {
                resposta.json().then(function (fichas) {
                    qtFichas.innerHTML = fichas.length

                    if (fichas.length > 0) {

                        for (let i = 0; i < fichas.length; i++) {
                            let ficha = fichas[i];

                            ficha_body.innerHTML += `
                            <div class="ficha_item" id="ficha_${ficha.id_ficha}">
                                <h3>${ficha.nomeFicha}</h3>
                                <p>Classe: <b>${ficha.classeNome}</b></p>
                                <p>Raça: <b>${ficha.racaNome}</b></p>

                                <hr>

                                <a onclick="visualizarFicha(${ficha.id_ficha})" class="btn_primario">
                                    <span>Visualizar Ficha</span>
                                </a>
                            </div>`
                        }
                    }
                })
            } else {
                qtFichas.innerHTML = 0;

                ficha_body.innerHTML += `
                    <div class="sem_ficha">
                        <h3>Nenhum personagem ainda ?</h3>
                        <p>Comece sua jornada criando seu primeiro personagem de RPG!</p>
                        <a href="ficha.html" class="btn_primario">
                            <span>Criar Primeiro Personagem</span>
                        </a>
                    </div>`;
            }
        });
    }

    function visualizarFicha(idFicha) {
        window.location = "./dashboard.html#" + idFicha;
    }
</script>

</html>